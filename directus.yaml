version: 1
directus: 11.13.0
vendor: postgres

# Metadata-only config: no `schema:` sections below.
# Apply with: `npx directus schema apply directus.yaml`
collections:
  - collection: organizations
    meta:
      managed: false
      icon: corporate_fare
      note: Limited Partners / Organizations
      display_template: "{{name}}"

  - collection: fund
    meta:
      managed: false
      icon: savings
      note: Master list of funds
      display_template: "{{name}}"

  - collection: company
    meta:
      managed: false
      icon: business
      note: Master list of companies
      display_template: "{{name}}"

  - collection: fund_report
    meta:
      managed: false
      icon: description
      note: Quarterly fund reports
      display_template: "{{fund_name}} — {{report_date}}"

  - collection: company_report
    meta:
      managed: false
      icon: analytics
      note: Company-level quarterly reports
      display_template: "{{company_name}} — {{report_date}}"

fields: []

relations:
  # user -> organization (m2o)
  - collection: directus_users
    field: organization_id
    related_collection: organizations
    meta:
      relation_type: m2o
      one_deselect_action: nullify

  # fund_report -> organizations (m2o)
  - collection: fund_report
    field: organization_id
    related_collection: organizations
    meta:
      relation_type: m2o
      one_deselect_action: delete

  # fund_report -> fund (m2o)
  - collection: fund_report
    field: fund_id
    related_collection: fund
    meta:
      relation_type: m2o
      one_deselect_action: nullify

  # company_report -> fund_report (m2o)
  - collection: company_report
    field: fund_report_id
    related_collection: fund_report
    meta:
      relation_type: m2o
      one_deselect_action: delete

  # company_report -> company (m2o)
  - collection: company_report
    field: company_id
    related_collection: company
    meta:
      relation_type: m2o
      one_deselect_action: nullify